<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workflow Engine | ProFlow</title>
    <style>
        :root {
            --primary: #2874f0;
            --success: #388e3c;
            --error: #d32f2f;
            --bg: #f1f3f6;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 40px 20px; }
        .workflow-card { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }

        /* Progress Bar */
        .progress-container { margin-bottom: 30px; }
        .progress-track { height: 10px; background: #e0e0e0; border-radius: 5px; position: relative; }
        #progress-bar { height: 100%; width: 25%; background: var(--primary); border-radius: 5px; transition: 0.4s ease; }
        .step-labels { display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.8rem; color: #666; }
        .step-labels b { color: var(--primary); }

        /* Stage Handling */
        .stage { display: none; }
        .stage.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h2 { color: #212121; margin-top: 0; }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        
        /* Validation */
        .error-text { color: var(--error); font-size: 0.85rem; margin-top: 5px; display: none; }
        .invalid input { border-color: var(--error); background: #fff8f8; }
        .invalid .error-text { display: block; }

        /* Navigation */
        .nav-btns { display: flex; justify-content: space-between; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; }
        .btn { padding: 12px 25px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-next { background: var(--primary); color: white; }
        .btn-prev { background: #eee; color: #333; }
        .btn-submit { background: var(--success); color: white; display: none; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
</head>
<body>

<div class="workflow-card">
    <div class="progress-container">
        <div class="progress-track"><div id="progress-bar"></div></div>
        <div class="step-labels">
            <span>Identity</span>
            <span>Business</span>
            <span>Bank</span>
            <span>Review</span>
        </div>
    </div>

    <form id="workflowForm">
        <div class="stage active" id="stage1">
            <h2>Personal Identity</h2>
            <div class="input-group">
                <label>Full Name</label>
                <input type="text" id="fullName" placeholder="Enter name">
                <div class="error-text">Name is required (min 3 chars).</div>
            </div>
            <div class="input-group">
                <label>Email Address</label>
                <input type="email" id="email" placeholder="email@example.com">
                <div class="error-text">Enter a valid email address.</div>
            </div>
        </div>

        <div class="stage" id="stage2">
            <h2>Business Details</h2>
            <div class="input-group">
                <label>GST Number (India)</label>
                <input type="text" id="gstin" placeholder="15-digit GSTIN">
                <div class="error-text">Invalid GSTIN format.</div>
            </div>
            <div class="input-group">
                <label>Company Type</label>
                <select id="companyType">
                    <option value="">Select Type</option>
                    <option value="prop">Proprietorship</option>
                    <option value="pvt">Pvt Ltd</option>
                </select>
                <div class="error-text">Please select a company type.</div>
            </div>
        </div>

        <div class="stage" id="stage3">
            <h2>Banking Information</h2>
            <div class="input-group">
                <label>Account Number</label>
                <input type="password" id="accNo" placeholder="Enter bank account">
                <div class="error-text">Minimum 10 digits required.</div>
            </div>
            <div class="input-group">
                <label>IFSC Code</label>
                <input type="text" id="ifsc" placeholder="SBIN0001234">
                <div class="error-text">Enter valid 11-digit IFSC.</div>
            </div>
        </div>

        <div class="stage" id="stage4">
            <h2>Review & Submit</h2>
            <div id="review-content" style="background: #f9f9f9; padding: 15px; border-radius: 6px;">
                </div>
            <p style="font-size: 0.8rem; margin-top: 15px;">
                <input type="checkbox" id="terms"> I agree to the terms and conditions.
            </p>
        </div>

        <div class="nav-btns">
            <button type="button" class="btn btn-prev" id="prevBtn" disabled onclick="changeStage(-1)">Previous</button>
            <button type="button" class="btn btn-next" id="nextBtn" onclick="changeStage(1)">Next Step</button>
            <button type="submit" class="btn btn-submit" id="submitBtn">Submit Application</button>
        </div>
    </form>
</div>



<script>
    // 1. TEMPORARY DATA STORE
    let formData = {};
    let currentStage = 1;

    const stages = document.querySelectorAll('.stage');
    const progressBar = document.getElementById('progress-bar');
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const submitBtn = document.getElementById('submitBtn');

    // 2. VALIDATION ENGINE
    function validateStage(stageNum) {
        let isValid = true;
        const currentDiv = document.getElementById(`stage${stageNum}`);
        
        // Dynamic Validation Logic
        if (stageNum === 1) {
            const name = document.getElementById('fullName');
            const email = document.getElementById('email');
            
            if (name.value.length < 3) { toggleErr(name, true); isValid = false; }
            else toggleErr(name, false);

            if (!email.value.includes('@')) { toggleErr(email, true); isValid = false; }
            else toggleErr(email, false);
        }

        if (stageNum === 2) {
            const gstin = document.getElementById('gstin');
            const type = document.getElementById('companyType');
            
            if (gstin.value.length !== 15) { toggleErr(gstin, true); isValid = false; }
            else toggleErr(gstin, false);

            if (type.value === "") { toggleErr(type, true); isValid = false; }
            else toggleErr(type, false);
        }

        if (stageNum === 3) {
            const acc = document.getElementById('accNo');
            const ifsc = document.getElementById('ifsc');
            
            if (acc.value.length < 10) { toggleErr(acc, true); isValid = false; }
            else toggleErr(acc, false);

            if (ifsc.value.length !== 11) { toggleErr(ifsc, true); isValid = false; }
            else toggleErr(ifsc, false);
        }

        return isValid;
    }

    function toggleErr(el, isErr) {
        const parent = el.closest('.input-group');
        if (isErr) parent.classList.add('invalid');
        else parent.classList.remove('invalid');
    }

    // 3. NAVIGATION LOGIC
    function changeStage(direction) {
        // Only validate if going forward
        if (direction === 1 && !validateStage(currentStage)) return;

        // Save current stage inputs to JavaScript variable
        saveInputs();

        // Update stage count
        currentStage += direction;
        
        // DOM Manipulation: Show/Hide Stages
        stages.forEach((s, idx) => {
            s.classList.toggle('active', (idx + 1) === currentStage);
        });

        // Update UI Elements
        updateUI();
    }

    function saveInputs() {
        const activeStage = document.getElementById(`stage${currentStage}`);
        const inputs = activeStage.querySelectorAll('input, select');
        inputs.forEach(input => {
            formData[input.id] = input.value;
        });
    }

    function updateUI() {
        // Update Progress Bar
        progressBar.style.width = (currentStage / 4) * 100 + "%";

        // Toggle Buttons
        prevBtn.disabled = currentStage === 1;
        
        if (currentStage === 4) {
            nextBtn.style.display = 'none';
            submitBtn.style.display = 'block';
            renderReview();
        } else {
            nextBtn.style.display = 'block';
            submitBtn.style.display = 'none';
        }
    }

    function renderReview() {
        const review = document.getElementById('review-content');
        review.innerHTML = `
            <p><b>Name:</b> ${formData.fullName}</p>
            <p><b>Business:</b> ${formData.gstin} (${formData.companyType})</p>
            <p><b>IFSC:</b> ${formData.ifsc}</p>
        `;
    }

    // 4. SUBMISSION HANDLING
    document.getElementById('workflowForm').onsubmit = (e) => {
        e.preventDefault();
        if (!document.getElementById('terms').checked) {
            alert("Please accept the terms!");
            return;
        }
        alert("Workflow Complete! Data ready for server: " + JSON.stringify(formData));
    };
</script>

</body>
</html>