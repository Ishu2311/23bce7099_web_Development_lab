<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartCart India | Coupon Engine</title>
    <style>
        :root {
            --primary: #fb641b; 
            --secondary: #2874f0;
            --bg: #f1f3f6;
            --success: #388e3c;
            --danger: #d32f2f;
            --muted: #878787;
        }

        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .wrapper { max-width: 1100px; margin: 0 auto; display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 20px; }

        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); height: fit-content; }
        h2 { border-bottom: 1px solid #ddd; padding-bottom: 10px; color: #212121; margin-top: 0; }

        /* Inventory List */
        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f0f0f0; }
        .item-info b { display: block; font-size: 1.1rem; }
        .stock-tag { font-size: 0.85rem; font-weight: bold; margin-top: 4px; display: inline-block; }
        .low-stock { color: var(--danger); }
        .in-stock { color: var(--success); }

        /* Cart Styling */
        .cart-item { display: flex; justify-content: space-between; margin-bottom: 15px; padding: 10px; background: #f9f9f9; border-radius: 4px; border-left: 4px solid var(--secondary); }
        .qty-btns { display: flex; align-items: center; gap: 10px; }
        
        .btn { border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-add { background: var(--secondary); color: white; }
        .btn-add:disabled { background: #ccc; cursor: not-allowed; }
        .btn-qty { background: #e0e0e0; width: 30px; padding: 5px; }

        /* Coupon Section */
        .coupon-container { display: flex; gap: 10px; margin: 15px 0 5px 0; }
        input#coupon { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        .btn-coupon { background: var(--primary); color: white; padding: 0 20px; }
        #coupon-msg { font-size: 0.8rem; margin-bottom: 15px; min-height: 18px; }

        /* Billing Section */
        .bill-row { display: flex; justify-content: space-between; margin: 8px 0; font-size: 0.95rem; }
        .discount { color: var(--success); font-weight: bold; }
        .grand-total { border-top: 2px dashed #ccc; padding-top: 15px; margin-top: 15px; font-size: 1.4rem; font-weight: bold; color: #212121; }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="card">
        <h2>Superstore Inventory</h2>
        <div id="inventory"></div>
    </div>

    <div class="card">
        <h2>Cart Summary</h2>
        <div id="cart-list">
            <p style="text-align:center; color:var(--muted);">Your cart is empty</p>
        </div>

        <div class="coupon-container">
            <input type="text" id="coupon" placeholder="Enter FESTIVE500">
            <button class="btn btn-coupon" onclick="verifyCoupon()">APPLY</button>
        </div>
        <div id="coupon-msg"></div>
        
        <div id="bill-summary"></div>
    </div>
</div>



<script>
    const products = [
        { id: 1, name: "Noise Buds Wireless", price: 1999, category: "Tech", stock: 5 },
        { id: 2, name: "Pigeon Electric Kettle", price: 850, category: "Home", stock: 10 },
        { id: 3, name: "SanDisk 128GB Pendrive", price: 899, category: "Tech", stock: 15 },
        { id: 4, name: "Kent RO Purifier", price: 12500, category: "Home", stock: 2 },
        { id: 5, name: "Logitech Wireless Mouse", price: 699, category: "Tech", stock: 8 },
        { id: 6, name: "Prestige Induction Cooktop", price: 2499, category: "Home", stock: 4 }
    ];

    let cart = [];
    let isCouponApplied = false;
    let promoCode = "FESTIVE500";

    function renderInventory() {
        const invDiv = document.getElementById('inventory');
        invDiv.innerHTML = products.map(p => {
            const isOutOfStock = p.stock <= 0;
            return `
                <div class="item-row">
                    <div class="item-info">
                        <b>${p.name}</b>
                        <small>₹${p.price.toLocaleString('en-IN')} | ${p.category}</small><br>
                        <span class="stock-tag ${p.stock < 5 ? 'low-stock' : 'in-stock'}">
                            ${isOutOfStock ? 'OUT OF STOCK' : `In Stock: ${p.stock}`}
                        </span>
                    </div>
                    <button class="btn btn-add" onclick="addToCart(${p.id})" ${isOutOfStock ? 'disabled' : ''}>
                        ${isOutOfStock ? 'SOLD OUT' : 'ADD TO CART'}
                    </button>
                </div>
            `;
        }).join('');
    }

    function addToCart(id) {
        const product = products.find(p => p.id === id);
        if (product.stock > 0) {
            const inCart = cart.find(item => item.id === id);
            if (inCart) inCart.qty++;
            else cart.push({ ...product, qty: 1 });
            product.stock--;
            updateAll();
        }
    }

    function updateQty(id, change) {
        const product = products.find(p => p.id === id);
        const cartItem = cart.find(i => i.id === id);
        if (change > 0) {
            if (product.stock > 0) { cartItem.qty++; product.stock--; }
            else alert("No more stock!");
        } else {
            cartItem.qty--; product.stock++;
            if (cartItem.qty <= 0) cart = cart.filter(i => i.id !== id);
        }
        updateAll();
    }

    // NEW LOGIC: Dedicated Coupon Verification
    function verifyCoupon() {
        const input = document.getElementById('coupon').value.trim().toUpperCase();
        const msg = document.getElementById('coupon-msg');
        const subtotal = cart.reduce((acc, item) => acc + (item.price * item.qty), 0);

        if (cart.length === 0) {
            msg.innerText = "Cart is empty!";
            msg.style.color = "var(--danger)";
            return;
        }

        if (input === promoCode) {
            if (subtotal >= 5000) {
                isCouponApplied = true;
                msg.innerText = "✓ FESTIVE500 applied successfully!";
                msg.style.color = "var(--success)";
            } else {
                isCouponApplied = false;
                msg.innerText = "Add ₹" + (5000 - subtotal) + " more to use this coupon.";
                msg.style.color = "var(--danger)";
            }
        } else {
            isCouponApplied = false;
            msg.innerText = "Invalid coupon code.";
            msg.style.color = "var(--danger)";
        }
        updateAll();
    }

    function calculateBill() {
        let subtotal = 0;
        let discount = 0;

        cart.forEach(item => {
            let lineTotal = item.price * item.qty;
            subtotal += lineTotal;
            if (item.qty >= 3) discount += (lineTotal * 0.15);
        });

        // Apply coupon discount if verified
        if (isCouponApplied) discount += 500;

        const taxable = subtotal - discount;
        const gst = taxable * 0.18;
        return { subtotal, discount, gst, total: taxable + gst };
    }

    function updateAll() {
        renderInventory();
        const listDiv = document.getElementById('cart-list');
        const billDiv = document.getElementById('bill-summary');

        if (cart.length === 0) {
            listDiv.innerHTML = `<p style="text-align:center; color:var(--muted);">Your cart is empty</p>`;
            billDiv.innerHTML = "";
            isCouponApplied = false; // Reset coupon if cart is emptied
            document.getElementById('coupon-msg').innerText = "";
            return;
        }

        listDiv.innerHTML = cart.map(item => `
            <div class="cart-item">
                <div><b>${item.name}</b><br>₹${item.price.toLocaleString('en-IN')} x ${item.qty}</div>
                <div class="qty-btns">
                    <button class="btn btn-qty" onclick="updateQty(${item.id}, -1)">-</button>
                    <span>${item.qty}</span>
                    <button class="btn btn-qty" onclick="updateQty(${item.id}, 1)">+</button>
                </div>
            </div>
        `).join('');

        const bill = calculateBill();
        billDiv.innerHTML = `
            <div class="bill-row"><span>Items (${cart.reduce((a, b) => a + b.qty, 0)})</span><span>₹${bill.subtotal.toLocaleString('en-IN')}</span></div>
            <div class="bill-row discount"><span>Discounts</span><span>-₹${bill.discount.toLocaleString('en-IN')}</span></div>
            <div class="bill-row"><span>GST (18%)</span><span>+₹${bill.gst.toLocaleString('en-IN')}</span></div>
            <div class="bill-row grand-total"><span>Total Payable</span><span>₹${Math.round(bill.total).toLocaleString('en-IN')}</span></div>
        `;
    }

    renderInventory();
</script>

</body>
</html>